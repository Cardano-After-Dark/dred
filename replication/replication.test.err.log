Found '/Users/psuzzi/projects/cad/dred/.nvmrc' with version <20>
Now using node v20.19.1 (npm v10.8.2)

  ✓ Docker container dred_redis is running

{ __dirname: '/Users/psuzzi/projects/cad/dred' }

 RUN  v3.1.2 /Users/psuzzi/projects/cad/dred

zonedLogger: default log levels: {"1":"info","defaultLevel":"warn"}
{"level":40,"time":1747179872078,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"default=info at     at zonedLogger (file:///Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+utils@0.8.2/node_modules/@poshplum/utils/src/zonedLogger.js:744:20)\n    at /Users/psuzzi/projects/cad/dred/src/server/testServer.ts:56:18\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at VitestExecutor.runModule (file:///Users/psuzzi/projects/cad/dred/node_modules/.pnpm/vite-node@3.1.2_@types+node@18.19.87_jiti@2.4.2_lightningcss@1.29.2/node_modules/vite-node/dist/client.mjs:354:3)\n    at VitestExecutor.directRequest (file:///Users/psuzzi/projects/cad/dred/node_modules/.pnpm/vite-node@3.1.2_@types+node@18.19.87_jiti@2.4.2_lightningcss@1.29.2/node_modules/vite-node/dist/client.mjs:333:3)\n    at VitestExecutor.cachedRequest (file:///Users/psuzzi/projects/cad/dred/node_modules/.pnpm/vite-node@3.1.2_@types+node@18.19.87_jiti@2.4.2_lightningcss@1.29.2/node_modules/vite-node/dist/client.mjs:168:11)\n    at VitestExecutor.dependencyRequest (file:///Users/psuzzi/projects/cad/dred/node_modules/.pnpm/vite-node@3.1.2_@types+node@18.19.87_jiti@2.4.2_lightningcss@1.29.2/node_modules/vite-node/dist/client.mjs:216:10)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts
NOTE: to enable granular monitoring of redis activity, set REDIS_MONITOR=1

stdout | src/server/__tests__/replication.test.ts
isColorSupported true

{"level":40,"time":1747179872082,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"dred‹first›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872082,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"+server 'first' {\"localDevHosts\":[{\"serverId\":\"first\",\"address\":\"localhost\",\"port\":\"53032\",\"insecure\":true},{\"serverId\":\"second\",\"address\":\"localhost\",\"port\":\"53033\",\"insecure\":true},{\"serverId\":\"third\",\"address\":\"localhost\",\"port\":\"53034\",\"insecure\":true}]} null 2","v":1}
{"level":30,"time":1747179872082,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Setting up Redis connection: redis://localhost:6379, db: 1","v":1}
{"level":30,"time":1747179872085,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Setting up message replication for server first","v":1}
{"level":30,"time":1747179872097,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Found 2 other hosts for replication","v":1}
{"level":40,"time":1747179872097,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹second-1›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872106,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872107,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872124,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Replication: setup for peer server second complete","v":1}
{"level":40,"time":1747179872124,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹third-2›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872125,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872125,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872127,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Replication: setup for peer server third complete","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872127,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179872127,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872130,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872130,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872130,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872130,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
stderr | src/server/__tests__/replication.test.ts > message replication
fetch error; see debugger -  TypeError: fetch failed
    at node:internal/deps/undici/undici:12625:11
    at ZoneDelegate.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:359:26)
    at Zone.run (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:147:43)
    at /Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:863:34
    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)
    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)
    at drainMicroTaskQueue (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:569:35)
    at processTicksAndRejections (node:internal/process/task_queues:95:5) {
  cause: Error: connect ECONNREFUSED ::1:53033
      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16) {
    errno: -61,
    code: 'ECONNREFUSED',
    syscall: 'connect',
    address: '::1',
    port: 53033
  }
}

stdout | src/server/__tests__/replication.test.ts > message replication
cleanup:  localhost [second at localhost] connection failure

stdout | src/server/__tests__/replication.test.ts > message replication
cleanup:  localhost [third at localhost] connection failure

stderr | src/server/__tests__/replication.test.ts > message replication
fetch error; see debugger -  TypeError: fetch failed
    at node:internal/deps/undici/undici:12625:11
    at ZoneDelegate.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:359:26)
    at Zone.run (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:147:43)
    at /Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:863:34
    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)
    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)
    at drainMicroTaskQueue (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:569:35)
    at processTicksAndRejections (node:internal/process/task_queues:95:5) {
  cause: Error: connect ECONNREFUSED ::1:53034
      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16) {
    errno: -61,
    code: 'ECONNREFUSED',
    syscall: 'connect',
    address: '::1',
    port: 53034
  }
}

{"level":30,"time":1747179872140,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179872141,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179872144,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179872145,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179872147,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"server 'first' listening at localhost:53032","v":1}
{"level":40,"time":1747179872147,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"dred‹second›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872147,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"+server 'second' {\"localDevHosts\":[{\"serverId\":\"first\",\"address\":\"localhost\",\"port\":\"53032\",\"insecure\":true},{\"serverId\":\"second\",\"address\":\"localhost\",\"port\":\"53033\",\"insecure\":true},{\"serverId\":\"third\",\"address\":\"localhost\",\"port\":\"53034\",\"insecure\":true}]} null 2","v":1}
{"level":30,"time":1747179872148,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Setting up Redis connection: redis://localhost:6379, db: 2","v":1}
{"level":30,"time":1747179872148,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Setting up message replication for server second","v":1}
{"level":30,"time":1747179872149,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Found 2 other hosts for replication","v":1}
{"level":40,"time":1747179872149,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹first-3›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872149,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872150,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872151,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Replication: setup for peer server first complete","v":1}
{"level":40,"time":1747179872151,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹third-4›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872151,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872151,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872152,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Replication: setup for peer server third complete","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872153,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179872153,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872156,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872157,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872157,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872157,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
cleanup:  localhost [third at localhost] connection failure

{"level":30,"time":1747179872167,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"-> POST /channels/listen","v":1}
{"level":30,"time":1747179872173,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"listening for [{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_chans\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_auth\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"*\"}]","v":1}
stderr | src/server/__tests__/replication.test.ts > message replication
fetch error; see debugger -  TypeError: fetch failed
    at node:internal/deps/undici/undici:12625:11
    at ZoneDelegate.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:359:26)
    at Zone.run (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:147:43)
    at /Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:863:34
    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)
    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)
    at drainMicroTaskQueue (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:569:35)
    at processTicksAndRejections (node:internal/process/task_queues:95:5) {
  cause: Error: connect ECONNREFUSED ::1:53034
      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16) {
    errno: -61,
    code: 'ECONNREFUSED',
    syscall: 'connect',
    address: '::1',
    port: 53034
  }
}

{"level":30,"time":1747179872178,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179872183,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179872184,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179872185,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179872186,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"server 'second' listening at localhost:53033","v":1}
{"level":40,"time":1747179872187,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"dred‹third›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872187,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"+server 'third' {\"localDevHosts\":[{\"serverId\":\"first\",\"address\":\"localhost\",\"port\":\"53032\",\"insecure\":true},{\"serverId\":\"second\",\"address\":\"localhost\",\"port\":\"53033\",\"insecure\":true},{\"serverId\":\"third\",\"address\":\"localhost\",\"port\":\"53034\",\"insecure\":true}]} null 2","v":1}
{"level":30,"time":1747179872187,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Setting up Redis connection: redis://localhost:6379, db: 3","v":1}
{"level":30,"time":1747179872187,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Setting up message replication for server third","v":1}
{"level":30,"time":1747179872188,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Found 2 other hosts for replication","v":1}
{"level":40,"time":1747179872188,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹first-5›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872188,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872189,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872190,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: setup for peer server first complete","v":1}
{"level":40,"time":1747179872190,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹second-6›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872190,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872190,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179872192,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: setup for peer server second complete","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872192,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179872192,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872194,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872194,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872194,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872195,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179872197,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"-> POST /channels/listen","v":1}
{"level":30,"time":1747179872198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"listening for [{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_chans\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_auth\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"*\"}]","v":1}
{"level":30,"time":1747179872198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179872198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"-> POST /channels/listen","v":1}
{"level":30,"time":1747179872198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"listening for [{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_chans\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_auth\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"*\"}]","v":1}
{"level":30,"time":1747179872201,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
warning from host first : {
  channel: '*',
  type: 'warning',
  message: 'invalid or expired channel'
}

{"level":30,"time":1747179872202,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179872203,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179872204,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"server 'third' listening at localhost:53034","v":1}
{"level":40,"time":1747179872205,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹first-7›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872205,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872205,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872206,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872208,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹first-8›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872208,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872208,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872209,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","context":[],"indent":"        ","summary":"client-‹second-9›=info by (env LOGGING=1)","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872209,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179872209,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"zonedLogger","transitionName":"default","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()"],"indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872210,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179872210,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"setupPending","context":["🗜️connection-manager @discoveringNbh transition default⦡ discoveringNbh","🗜️ConnectionManager ↝ default-state onEntry onEntry()","🗜️connection-manager @discoveringNbh transition setupPending⦡ pendingSetup"],"summary":"connection-manager @discoveringNbh  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872210,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872210,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872211,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872211,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
{"level":40,"time":1747179872211,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
    🐞 ConnectionManager: pendingSetup: deferred until channel subscriptions are set

{"level":30,"time":1747179872211,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"updatedHostList","context":["🗜️connection-manager @pendingSetup transition updatedHostList⦡ pendingSetup"],"summary":"connection-manager @pendingSetup  ➜ pendingSetup","msg":" ✓ transitioned","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication
warning from host second : {
  channel: '*',
  type: 'warning',
  message: 'invalid or expired channel'
}

stdout | src/server/__tests__/replication.test.ts > message replication
warning from host first : {
  channel: '*',
  type: 'warning',
  message: 'invalid or expired channel'
}

{"level":30,"time":1747179872712,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"beforeEach: flushing redis","v":1}
{"level":30,"time":1747179879176,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"server: client <- heartbeat","v":1}
{"level":30,"time":1747179879198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"server: client <- heartbeat","v":1}
{"level":30,"time":1747179879198,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"server: client <- heartbeat","v":1}
{"level":50,"time":1747179882233,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {}","v":1}
{"level":50,"time":1747179882233,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"_chans consume error; TODO: reconnect/retry {\"error\":{}}","v":1}
{"level":30,"time":1747179882234,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"<- 200 POST /channels/listen 10067ms","v":1}
{"level":50,"time":1747179882234,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}","v":1}
{"level":50,"time":1747179882234,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"* consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}}","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"* consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}}","v":1}
{"level":30,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"<- 200 POST /channels/listen 10038ms","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"_auth consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}}","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_chans\"]}}","v":1}
{"level":50,"time":1747179882235,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"_chans consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_chans\"]}}}","v":1}
{"level":30,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Replication: received message on channel * from peer first","v":1}
{"level":40,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Replication: Failed to replicate message to channel *: TypeError: producer.add is not a function","v":1}
{"level":50,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}","v":1}
{"level":50,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"_auth consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}}","v":1}
{"level":30,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: received message on channel * from peer first","v":1}
{"level":40,"time":1747179882236,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: Failed to replicate message to channel *: TypeError: producer.add is not a function","v":1}
{"level":30,"time":1747179882240,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Setting up Redis connection: redis://localhost:6379, db: 1","v":1}
{"level":30,"time":1747179882243,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179882244,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179882246,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179882247,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179882247,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"beforeEach: flushing redis","v":1}
{"level":30,"time":1747179886199,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"server: client <- heartbeat","v":1}
{"level":50,"time":1747179892289,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {}","v":1}
{"level":50,"time":1747179892289,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"_chans consume error; TODO: reconnect/retry {\"error\":{}}","v":1}
{"level":30,"time":1747179892289,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"<- 200 POST /channels/listen 20091ms","v":1}
{"level":50,"time":1747179892290,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}","v":1}
{"level":50,"time":1747179892290,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"_auth consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|_auth\"]}}}","v":1}
{"level":50,"time":1747179892291,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}","v":1}
{"level":50,"time":1747179892292,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"* consume error; TODO: reconnect/retry {\"error\":{\"command\":{\"name\":\"xinfo\",\"args\":[\"STREAM\",\"app-channels-1|*\"]}}}","v":1}
{"level":30,"time":1747179892292,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: received message on channel * from peer second","v":1}
{"level":40,"time":1747179892292,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Replication: Failed to replicate message to channel *: TypeError: producer.add is not a function","v":1}
{"level":30,"time":1747179892295,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Setting up Redis connection: redis://localhost:6379, db: 2","v":1}
{"level":30,"time":1747179892301,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179892303,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179892305,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179892308,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179892308,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"beforeEach: flushing redis","v":1}
{"level":30,"time":1747179892310,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Setting up Redis connection: redis://localhost:6379, db: 3","v":1}
{"level":30,"time":1747179892315,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179892317,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179892319,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179892321,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179892329,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"-> POST /channel/replication-test-channel","v":1}
{"level":30,"time":1747179892332,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated replication-test-channel {\"channelId\":\"replication-test-channel\",\"members\":[],\"requests\":[],\"approveJoins\":\"owner\",\"createdAt\":\"2025-05-13T23:44:52.331Z\"}","v":1}
{"level":30,"time":1747179892335,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"<- 200 POST /channel/replication-test-channel 6ms","v":1}
{"level":30,"time":1747179892544,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"-> GET /channels","v":1}
{"level":30,"time":1747179892558,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"-> POST /channels/listen","v":1}
{"level":30,"time":1747179892559,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"listening for [{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_chans\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"_auth\"},{\"neighborhood\":\"cardano-after-dark\",\"channel\":\"replication-test-channel\"}]","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication > replicates messages between servers
warning from host second : {
  channel: 'replication-test-channel',
  type: 'warning',
  message: 'invalid or expired channel'
}

{"level":30,"time":1747179892771,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"-> POST /channel/replication-test-channel/message","v":1}
{"level":30,"time":1747179892772,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"postMessageInChannel replication-test-channel","v":1}
{"level":30,"time":1747179892777,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"server: postMessage {\"msg\":\"{\\\"content\\\":\\\"Test replication message\\\"}\",\"type\":\"replication-test\",\"ocid\":\"test-ocid-1747179892554\",\"sourceServer\":\"first\"}","v":1}
{"level":30,"time":1747179892779,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"<- 200 POST /channel/replication-test-channel/message 8ms","v":1}
{"level":30,"time":1747179893786,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: clean up clients","v":1}
{"level":40,"time":1747179893786,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":40,"time":1747179893788,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"root","name":"zonedLogger","indent":"        ","summary":"connection-manager:state=info by state-machine: connection-manager definition","msg":"▒▒▒▒ log override ▒▒▒▒","v":1}
{"level":30,"time":1747179893788,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"disconnected","context":["🗜️connection-manager @pendingSetup transition disconnected⦡ disconnected"],"summary":"connection-manager @pendingSetup  ➜ disconnected","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179893788,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"connection-manager:state","transitionName":"disconnected","context":["🗜️connection-manager @pendingSetup transition disconnected⦡ disconnected"],"summary":"connection-manager @pendingSetup  ➜ disconnected","msg":" ✓ transitioned","v":1}
{"level":30,"time":1747179893941,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: flushing redis","v":1}
{"level":30,"time":1747179893943,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"Setting up Redis connection: redis://localhost:6379, db: 1","v":1}
{"level":30,"time":1747179893955,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179893958,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179893959,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179893962,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179893962,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: restoring default channels","v":1}
{"level":30,"time":1747179893962,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"------------------ did reset redis with default channels --------------","v":1}
{"level":30,"time":1747179893964,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179893966,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179893969,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179893971,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹first›","context":[],"serverId":"first","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179899560,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"server: client <- heartbeat","v":1}
{"level":50,"time":1747179902671,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {}","v":1}
{"level":50,"time":1747179902672,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"_chans consume error; TODO: reconnect/retry {\"error\":{}}","v":1}
{"level":30,"time":1747179902672,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"<- 200 POST /channels/listen 10114ms","v":1}
{"level":50,"time":1747179912679,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {}","v":1}
{"level":50,"time":1747179912679,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"_auth consume error; TODO: reconnect/retry {\"error\":{}}","v":1}
{"level":50,"time":1747179922754,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Consume error: {}","v":1}
{"level":50,"time":1747179922758,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"replication-test-channel consume error; TODO: reconnect/retry {\"error\":{}}","v":1}
{"level":30,"time":1747179922760,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: flushing redis","v":1}
{"level":50,"time":1747179922770,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Unsubscribe error: {}","v":1}
{"level":50,"time":1747179922770,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Unsubscribe error: {}","v":1}
{"level":50,"time":1747179922770,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Unsubscribe error: {}","v":1}
{"level":30,"time":1747179922788,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"Setting up Redis connection: redis://localhost:6379, db: 2","v":1}
stdout | src/server/__tests__/replication.test.ts > message replication > replicates messages between servers
Received message on second server: {
  connection: <ref *1> _HostConnection {
    _status: undefined,
    contextObject: [Circular *1],
    contextLabel: 'connection:second',
    logFacility: 'connection:state',
    logProperties: {},
    recentGeneration: 0,
    events: EventEmitter {
      _events: [Events <Complex prototype>],
      _eventsCount: 5
    },
    abortController: AbortController { signal: AbortSignal { aborted: false } },
    host: {
      serverId: 'second',
      address: 'localhost',
      port: '53033',
      insecure: true
    },
    settings: {
      retryBaseIntervalMs: 1000,
      retryMaxIntervalMs: 30000,
      maxRetries: Infinity,
      connectionWaitTimeMs: 7000
    },
    attempts: 0,
    lastError: undefined,
    channelSubs: [ [Object], [Object], [Object] ],
    stream: ReadableStream { locked: true, state: 'readable', supportsBYOB: false },
    startTime: 1747179892554,
    scheduledRetry: undefined,
    connecting: Promise { undefined },
    heartbeatInterval: undefined,
    lastHeartbeat: 1747179899561,
    heartbeatTimer: Timeout {
      _idleTimeout: 1,
      _idlePrev: null,
      _idleNext: null,
      _idleStart: 28093,
      _onTimeout: [Function: timer],
      _timerArgs: undefined,
      _repeat: null,
      _destroyed: true,
      __zone_symbol__zoneTask: null,
      [Symbol(refed)]: false,
      [Symbol(kHasPrimitive)]: false,
      [Symbol(asyncId)]: 2185,
      [Symbol(triggerId)]: 0
    }
  },
  message: 'msg received in chan',
  mid: undefined,
  ocid: undefined,
  type: 'error',
  msg: undefined,
  channel: 'replication-test-channel',
  details: {
    message: 'internal stream consumer failed',
    reason: 'Can not consume from the tunnel: app-channels-1|replication-test-channel 05d55d0277484087b1d70f2d9ad1eed8'
  },
  neighborhood: undefined,
  ts: 2025-05-13T23:45:22.761Z,
  [Symbol(?developer?)]: 'this indicates an internal problem being reflected out to you for any appropriate client-side treatment of the condition'
}

{"level":30,"time":1747179922792,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179922794,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179922796,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179922797,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179922797,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: restoring default channels","v":1}
{"level":30,"time":1747179922797,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"------------------ did reset redis with default channels --------------","v":1}
{"level":30,"time":1747179922798,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179922798,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179922799,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179922800,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹second›","context":[],"serverId":"second","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179922951,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: flushing redis","v":1}
{"level":30,"time":1747179922956,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Setting up Redis connection: redis://localhost:6379, db: 3","v":1}
{"level":30,"time":1747179922971,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _chans {\"channelId\":\"_chans\"}","v":1}
{"level":30,"time":1747179922972,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated _auth {\"channelId\":\"_auth\"}","v":1}
{"level":30,"time":1747179922974,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated news {\"channelId\":\"news\"}","v":1}
{"level":30,"time":1747179922976,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"channelCreated discussion {\"channelId\":\"discussion\"}","v":1}
{"level":30,"time":1747179922976,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"afterEach: restoring default channels","v":1}
{"level":30,"time":1747179922976,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"test","context":[],"color":"\u001b[33m","msg":"------------------ did reset redis with default channels --------------","v":1}
 ❯ src/server/__tests__/replication.test.ts (1 test | 1 failed) 50898ms
   × message replication > replicates messages between servers 50265ms
     → expected false to be true // Object.is equality
{"level":50,"time":1747179922981,"env":"test","pid":16001,"hostname":"max1p","type":"log","name":"dred‹third›","context":[],"serverId":"third","msg":"Produce error: Error: Connection is closed.\n    at close (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:184:25)\n    at Socket.<anonymous> (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:151:20)\n    at Object.onceWrapper (node:events:632:26)\n    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)\n    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)\n    at ZoneTask.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:471:34)\n    at Socket.ZoneTask.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:460:48)\n    at Socket.emit (node:events:517:28)\n    at TCP.<anonymous> (node:net:350:12)","v":1}

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/server/__tests__/replication.test.ts > message replication > replicates messages between servers
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 ❯ src/server/__tests__/replication.test.ts:85:33
     83|         
     84|         // Verify message was received on second server via subscription
     85|         expect(receivedMessage).toBe(true);
       |                                 ^
     86|         
     87|         // Additional verification: check if message can be retrieved from second server

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Errors ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

Vitest caught 5 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
AssertionError: expected undefined to be '{"content":"Test replication message"}' // Object.is equality

- Expected: 
"{\"content\":\"Test replication message\"}"

+ Received: 
undefined

 ❯ ChannelSubscriptionListener.replication-test-channel [as listener] src/server/__tests__/replication.test.ts:63:37
     61|             [channelName]: (message) => {
     62|                 console.log("Received message on second server:", message);
     63|                 expect(message.msg).toBe(testMessage.msg);
       |                                     ^
     64|                 expect(message.type).toBe(testMessage.type);
     65|                 expect(message.ocid).toBe(testMessage.ocid);
 ❯ ChannelSubscriptionListener.notify src/types/ChannelSubscriptions.ts:68:18
 ❯ ConnectionManager.notifySubscribers src/client/ConnectionManager.ts:482:14
 ❯ EventEmitter.emit node_modules/.pnpm/eventemitter3@5.0.1/node_modules/eventemitter3/index.js:181:35
 ❯ _HostConnection.monitorSubscriptions src/client/HostConnection.ts:479:25
 ❯ processTicksAndRejections node:internal/process/task_queues:95:5

This error originated in "src/server/__tests__/replication.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "replicates messages between servers". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Error: Can not unsubscribe for consumer : 9bf0f6cd6e1b4174b5ce1010191c65ef
 ❯ RedisChannels.unsubscribe src/redis/streams/channels.js:440:19
    438|                 throw error;
    439|             }
    440|             throw new RedisChannelsError(
       |                   ^
    441|                 "Can not unsubscribe for consumer : " + tunnel[tun.CONSUMER],
    442|                 error
 ❯ processTicksAndRejections node:internal/process/task_queues:95:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { error: { stack: 'Error: Connection is closed.\n    at close (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:184:25)\n    at Socket.<anonymous> (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:151:20)\n    at Object.onceWrapper (node:events:632:26)\n    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)\n    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)\n    at ZoneTask.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:471:34)\n    at Socket.ZoneTask.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:460:48)\n    at Socket.emit (node:events:517:28)\n    at TCP.<anonymous> (node:net:350:12)', message: 'Connection is closed.', constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } }
This error originated in "src/server/__tests__/replication.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "replicates messages between servers". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Error: Can not unsubscribe for consumer : 7724f7223df84bd9ab54ee8f55b65d1b
 ❯ RedisChannels.unsubscribe src/redis/streams/channels.js:440:19
    438|                 throw error;
    439|             }
    440|             throw new RedisChannelsError(
       |                   ^
    441|                 "Can not unsubscribe for consumer : " + tunnel[tun.CONSUMER],
    442|                 error
 ❯ processTicksAndRejections node:internal/process/task_queues:95:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { error: { stack: 'Error: Connection is closed.\n    at close (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:184:25)\n    at Socket.<anonymous> (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:151:20)\n    at Object.onceWrapper (node:events:632:26)\n    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)\n    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)\n    at ZoneTask.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:471:34)\n    at Socket.ZoneTask.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:460:48)\n    at Socket.emit (node:events:517:28)\n    at TCP.<anonymous> (node:net:350:12)', message: 'Connection is closed.', constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } }
This error originated in "src/server/__tests__/replication.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "replicates messages between servers". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Error: Can not unsubscribe for consumer : 05d55d0277484087b1d70f2d9ad1eed8
 ❯ RedisChannels.unsubscribe src/redis/streams/channels.js:440:19
    438|                 throw error;
    439|             }
    440|             throw new RedisChannelsError(
       |                   ^
    441|                 "Can not unsubscribe for consumer : " + tunnel[tun.CONSUMER],
    442|                 error
 ❯ processTicksAndRejections node:internal/process/task_queues:95:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { error: { stack: 'Error: Connection is closed.\n    at close (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:184:25)\n    at Socket.<anonymous> (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:151:20)\n    at Object.onceWrapper (node:events:632:26)\n    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)\n    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)\n    at ZoneTask.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:471:34)\n    at Socket.ZoneTask.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:460:48)\n    at Socket.emit (node:events:517:28)\n    at TCP.<anonymous> (node:net:350:12)', message: 'Connection is closed.', constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } }
This error originated in "src/server/__tests__/replication.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "replicates messages between servers". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Error: Can not produce in the tunnel: [object Object]
 ❯ RedisChannels.produce src/redis/streams/channels.js:493:19
    491|             this._log.error("Produce error:", error.stack || error.message || JSON.stringify(error));
    492|             debugger
    493|             throw new RedisChannelsError(
       |                   ^
    494|                 "Can not produce in the tunnel: " + tunnel,
    495|                 error
 ❯ processTicksAndRejections node:internal/process/task_queues:95:5
 ❯ DredServer.doChannelSetup src/server/DredServer.ts:315:9
 ❯ src/server/DredServer.ts:284:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { error: { stack: 'Error: Connection is closed.\n    at close (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:184:25)\n    at Socket.<anonymous> (/Users/psuzzi/projects/cad/dred/src/redis/streams/node_modules/ioredis/built/redis/event_handler.js:151:20)\n    at Object.onceWrapper (node:events:632:26)\n    at ZoneDelegate.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:389:31)\n    at Zone.runTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:174:43)\n    at ZoneTask.invokeTask (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:471:34)\n    at Socket.ZoneTask.invoke (/Users/psuzzi/projects/cad/dred/node_modules/.pnpm/@poshplum+zoned-cls@https+++codeload.github.com+poshplum+zoned-cls+tar.gz+4d42abe3d5e14c0f34f5704a7bb133630cb665b6/node_modules/@poshplum/zoned-cls/dist/zoned-cls-node.js:460:48)\n    at Socket.emit (node:events:517:28)\n    at TCP.<anonymous> (node:net:350:12)', message: 'Connection is closed.', constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } }
This error originated in "src/server/__tests__/replication.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯


 Test Files  1 failed (1)
      Tests  1 failed (1)
     Errors  5 errors
   Start at  01:44:31
   Duration  51.56s (transform 155ms, setup 0ms, collect 485ms, tests 50.90s, environment 0ms, prepare 44ms)

 ELIFECYCLE  Test failed. See above for more details.
~/projects/cad/dred feature/message-duplication *23 +2 ?3 >                                                                                                             53s